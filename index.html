<!-- <!DOCTYPE html>
<html>
<head>
  <title>SAP AR Toss</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ar.js@3.4.4/aframe/build/aframe-ar.js"></script>
  <script src="game.js"></script>

  <style>
    body { margin: 0; overflow: hidden; }
    #score {
      position: fixed;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 10px;
      z-index: 999;
    }
  </style>
</head>

<body>

<div id="score">Score: 0</div>

<a-scene
  vr-mode-ui="enabled: false"
  arjs="sourceType: webcam; debugUIEnabled: false;"
>

  <a-marker preset="hiro">

    <a-cylinder id="basket"
                position="0 0.25 0"
                radius="0.3"
                height="0.5"
                color="#333">
    </a-cylinder>

    <a-sphere id="sapBall"
              radius="0.08"
              position="0 0.6 0.5"
              color="#0a6ed1"
              ball-motion>
    </a-sphere>

  </a-marker>

  <a-entity camera></a-entity>

</a-scene>

</body>
</html> -->

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>WebAR Paper Toss - Final Universal</title>
    
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>

    <style>
        body { margin: 0; overflow: hidden; }
        #ar-ui {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1000; display: flex; justify-content: center; align-items: center;
            background: rgba(0,0,0,0.8); color: white; font-family: sans-serif;
        }
        button {
            padding: 20px 40px; font-size: 1.5rem; background: #2196F3;
            color: white; border: none; border-radius: 50px; cursor: pointer;
        }
        .instructions {
            position: fixed; bottom: 20px; width: 100%; text-align: center;
            color: white; text-shadow: 1px 1px 2px black; z-index: 500;
        }
    </style>
</head>

<body style="margin: 0px; overflow: hidden;">

    <div id="ar-ui">
        <div style="text-align: center;">
            <h1>Paper Toss AR</h1>
            <button onclick="initGame()">PLAY NOW</button>
            <p>Click to allow Camera access</p>
        </div>
    </div>

    <div class="instructions">Swipe UP to throw!</div>

    <a-scene 
        embedded 
        arjs='sourceType: webcam; debugUIEnabled: false;'
        physics="gravity: -9.8; debug: false">

        <a-entity camera look-controls position="0 1.6 0">
            <a-entity id="basket-group" position="0 -1 -3" rotation="0 0 0">
                <a-cylinder color="red" height="0.6" radius="0.3" open-ended="true" side="double" static-body></a-cylinder>
                <a-circle position="0 -0.29 0" rotation="-90 0 0" radius="0.3" color="black" static-body></a-circle>
            </a-entity>
        </a-camera>

        <a-plane position="0 0 0" rotation="-90 0 0" width="100" height="100" static-body transparent="true" opacity="0.1" color="#222"></a-plane>

    </a-scene>

    <script>
        function initGame() {
            document.getElementById('ar-ui').style.display = 'none';
            
            // Required for iOS to unlock sensors
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission();
            }
        }

        // SWIPE LOGIC
        let startY, startTime;
        window.addEventListener('touchstart', (e) => {
            startY = e.touches[0].clientY;
            startTime = Date.now();
        });

        window.addEventListener('touchend', (e) => {
            let endY = e.changedTouches[0].clientY;
            let duration = Date.now() - startTime;
            let distance = startY - endY;

            if (distance > 50 && duration < 300) {
                let speed = (distance / duration) * 10;
                throwPaper(speed);
            }
        });

        function throwPaper(speed) {
            const scene = document.querySelector('a-scene');
            const ball = document.createElement('a-sphere');
            
            // Get camera direction
            const camera = document.querySelector('[camera]');
            const position = camera.object3D.position;
            
            ball.setAttribute('radius', '0.1');
            ball.setAttribute('color', 'white');
            ball.setAttribute('position', `${position.x} ${position.y - 0.2} ${position.z - 0.5}`);
            ball.setAttribute('dynamic-body', 'mass: 0.5');
            
            scene.appendChild(ball);

            ball.addEventListener('body-loaded', () => {
                // Direction: Forward (-z) and Up (+y)
                const impulse = new CANNON.Vec3(0, speed * 0.5, -speed);
                ball.body.applyImpulse(impulse, new CANNON.Vec3(0, 0, 0));
                
                // Cleanup
                setTimeout(() => { if(ball.parentNode) ball.parentNode.removeChild(ball); }, 4000);
            });
        }
    </script>
</body>
</html>