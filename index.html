<!-- <!DOCTYPE html>
<html>
<head>
  <title>SAP AR Toss</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ar.js@3.4.4/aframe/build/aframe-ar.js"></script>
  <script src="game.js"></script>

  <style>
    body { margin: 0; overflow: hidden; }
    #score {
      position: fixed;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 10px;
      z-index: 999;
    }
  </style>
</head>

<body>

<div id="score">Score: 0</div>

<a-scene
  vr-mode-ui="enabled: false"
  arjs="sourceType: webcam; debugUIEnabled: false;"
>

  <a-marker preset="hiro">

    <a-cylinder id="basket"
                position="0 0.25 0"
                radius="0.3"
                height="0.5"
                color="#333">
    </a-cylinder>

    <a-sphere id="sapBall"
              radius="0.08"
              position="0 0.6 0.5"
              color="#0a6ed1"
              ball-motion>
    </a-sphere>

  </a-marker>

  <a-entity camera></a-entity>

</a-scene>

</body>
</html> -->

<!-- <!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>WebAR Paper Toss - Final</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>
</head>

<body style="margin: 0; overflow: hidden;">
    <div id="overlay" style="position:fixed; top:0; left:0; width:100%; height:100%; z-index:999; background:rgba(0,0,0,0.8); display:flex; flex-direction:column; justify-content:center; align-items:center; color:white; font-family:sans-serif;">
        <h1>AR Paper Toss</h1>
        <button onclick="start()" style="padding:15px 30px; font-size:20px; border-radius:10px; border:none; background:#2ecc71; color:white;">PLAY</button>
    </div>

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" physics="gravity: -9.8; debug: false">
        
        <a-entity id="rig" position="0 0 0">
            <a-camera id="cam" look-controls="enabled: true"></a-camera>
        </a-entity>

        <a-entity id="basket" position="0 0 -4">
            <a-cylinder color="#666" height="0.7" radius="0.4" open-ended="true" side="double" static-body></a-cylinder>
            <a-circle position="0 -0.3 0" rotation="-90 0 0" radius="0.4" color="#222" static-body></a-circle>
        </a-entity>

        <a-plane position="0 -0.5 0" rotation="-90 0 0" width="100" height="100" static-body transparent="true" opacity="0.2" color="#444"></a-plane>

        <a-light type="ambient" intensity="0.8"></a-light>
    </a-scene>

    <script>
        const scene = document.querySelector('a-scene');
        const cam = document.getElementById('cam');

        function start() {
            document.getElementById('overlay').style.display = 'none';
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission();
            }
        }

        let startY, startTime;
        window.addEventListener('touchstart', e => {
            startY = e.touches[0].clientY;
            startTime = Date.now();
        });

        window.addEventListener('touchend', e => {
            let duration = Date.now() - startTime;
            let dist = startY - e.changedTouches[0].clientY;
            if (dist > 50) {
                // Calculate strength based on swipe speed
                let strength = Math.min(dist / duration * 15, 25);
                throwBall(strength);
            }
        });

        function throwBall(speed) {
            const ball = document.createElement('a-sphere');
            ball.setAttribute('radius', '0.12');
            ball.setAttribute('color', 'white');
            
            // 1. Get Camera's World Position and Direction
            const pos = cam.object3D.position;
            const direction = new THREE.Vector3(0, 0, -1);
            direction.applyQuaternion(cam.object3D.quaternion);

            // 2. Set ball starting position slightly in front of camera
            ball.setAttribute('position', {
                x: pos.x + direction.x * 0.5,
                y: pos.y + direction.y * 0.5,
                z: pos.z + direction.z * 0.5
            });

            ball.setAttribute('dynamic-body', 'mass: 0.5');
            scene.appendChild(ball);

            ball.addEventListener('body-loaded', () => {
                // 3. Apply force in the direction the camera is facing
                // We add a little "up" force (0.3) so it arcs like a real toss
                const forceVector = new CANNON.Vec3(
                    direction.x * speed,
                    (direction.y + 0.5) * speed, 
                    direction.z * speed
                );
                
                ball.body.applyImpulse(forceVector, new CANNON.Vec3(0,0,0));
                
                // Cleanup
                setTimeout(() => { if(ball.parentNode) ball.parentNode.removeChild(ball); }, 4000);
            });
        }
    </script>
</body>
</html> -->


<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Stable WebAR Paper Toss</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>
</head>

<body style="margin: 0; overflow: hidden;">
    <div id="overlay" style="position:fixed; top:0; left:0; width:100%; height:100%; z-index:999; background:rgba(0,0,0,0.8); display:flex; flex-direction:column; justify-content:center; align-items:center; color:white; font-family:sans-serif;">
        <button onclick="start()" style="padding:15px 30px; font-size:20px; border-radius:10px; border:none; background:#3498db; color:white;">START GAME</button>
    </div>

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" physics="gravity: -9.8; debug: false">
        
        <a-camera id="cam" look-controls="enabled: true">
            <a-entity cursor="fuse: false" position="0 0 -1" geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.015" material="color: white; shader: flat"></a-entity>
        </a-camera>

        <a-entity id="basket-anchor" position="0 -1 -4">
            <a-cylinder color="#ff3333" height="0.8" radius="0.4" open-ended="true" side="double" static-body></a-cylinder>
            <a-circle position="0 -0.35 0" rotation="-90 0 0" radius="0.4" color="#111" static-body></a-circle>
        </a-entity>

        <a-light type="ambient" intensity="0.8"></a-light>
    </a-scene>

    <script>
        const scene = document.querySelector('a-scene');
        const cam = document.getElementById('cam');
        let isThrowing = false; // Prevents multiple balls at once

        function start() {
            document.getElementById('overlay').style.display = 'none';
        }

        let startY, startTime;
        window.addEventListener('touchstart', e => {
            startY = e.touches[0].clientY;
            startTime = Date.now();
        });

        window.addEventListener('touchend', e => {
            if (isThrowing) return; // Debounce check
            
            let duration = Date.now() - startTime;
            let dist = startY - e.changedTouches[0].clientY;
            
            if (dist > 60) {
                isThrowing = true;
                let strength = Math.min(dist / duration * 12, 22);
                throwBall(strength);
                
                // Allow next throw after 1 second
                setTimeout(() => { isThrowing = false; }, 1000);
            }
        });

        function throwBall(speed) {
            const ball = document.createElement('a-sphere');
            ball.setAttribute('radius', '0.12');
            ball.setAttribute('color', 'white');
            
            // Get camera's current position and rotation
            const pos = cam.object3D.position;
            const direction = new THREE.Vector3(0, 0, -1);
            direction.applyQuaternion(cam.object3D.quaternion);

            // Spawn ball exactly where you are looking
            ball.setAttribute('position', {
                x: pos.x + direction.x * 0.6,
                y: pos.y + direction.y * 0.6,
                z: pos.z + direction.z * 0.6
            });

            ball.setAttribute('dynamic-body', 'mass: 0.5; linearDamping: 0.01;');
            scene.appendChild(ball);

            ball.addEventListener('body-loaded', () => {
                // Add a slight arc to the throw (0.4 upward boost)
                const impulse = new CANNON.Vec3(
                    direction.x * speed,
                    (direction.y + 0.4) * speed, 
                    direction.z * speed
                );
                
                ball.body.applyImpulse(impulse, new CANNON.Vec3(0,0,0));
                
                // Remove ball to save memory
                setTimeout(() => { 
                    if(ball.parentNode) ball.parentNode.removeChild(ball); 
                }, 3500);
            });
        }
    </script>
</body>
</html>