<!-- <!DOCTYPE html>
<html>
<head>
  <title>SAP AR Toss</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ar.js@3.4.4/aframe/build/aframe-ar.js"></script>
  <script src="game.js"></script>

  <style>
    body { margin: 0; overflow: hidden; }
    #score {
      position: fixed;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 10px;
      z-index: 999;
    }
  </style>
</head>

<body>

<div id="score">Score: 0</div>

<a-scene
  vr-mode-ui="enabled: false"
  arjs="sourceType: webcam; debugUIEnabled: false;"
>

  <a-marker preset="hiro">

    <a-cylinder id="basket"
                position="0 0.25 0"
                radius="0.3"
                height="0.5"
                color="#333">
    </a-cylinder>

    <a-sphere id="sapBall"
              radius="0.08"
              position="0 0.6 0.5"
              color="#0a6ed1"
              ball-motion>
    </a-sphere>

  </a-marker>

  <a-entity camera></a-entity>

</a-scene>

</body>
</html> -->
<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>WebAR Paper Toss</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-world-aframe.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-physics-system@v4.2.2/dist/aframe-physics-system.min.js"></script>

    <style>
        body { margin: 0; overflow: hidden; font-family: sans-serif; }
        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 1000;
            display: flex; flex-direction: column; justify-content: center; align-items: center; color: white;
        }
        button {
            padding: 15px 30px; font-size: 1.2rem; background: #007bff;
            color: white; border: none; border-radius: 8px; cursor: pointer;
        }
        #ui-guide {
            position: absolute; top: 10px; width: 100%; text-align: center;
            color: white; z-index: 10; pointer-events: none; text-shadow: 2px 2px 4px #000;
        }
    </style>
</head>
<body>

    <div id="overlay">
        <h1>Paper Toss AR</h1>
        <p>Find a flat floor & swipe up to throw</p>
        <button id="startBtn">START GAME</button>
    </div>

    <div id="ui-guide">Swipe Up Fast!</div>

    <a-scene 
        mindar-world="autoStart: false;" 
        embedded 
        physics="gravity: -9.8; debug: false">
        
        <a-assets>
            <a-asset-item id="basketModel" src="https://vazxmixjsiawhamofees.supabase.co/storage/v1/object/public/models/trash-can/model.gltf"></a-asset-item>
        </a-assets>

        <a-camera position="0 1.2 0" look-controls="enabled: false"></a-camera>

        <a-entity id="target" position="0 0 -3">
            <a-entity gltf-model="#basketModel" scale="0.5 0.5 0.5" static-body></a-entity>
            <a-cylinder radius="0.2" height="0.5" position="0 0.2 0" visible="false" static-body></a-cylinder>
        </a-entity>

        <a-plane rotation="-90 0 0" width="100" height="100" static-body visible="false"></a-plane>

        <a-light type="ambient" intensity="0.8"></a-light>
        <a-light type="directional" position="1 2 1" intensity="0.5"></a-light>
    </a-scene>

    <script>
        const sceneEl = document.querySelector('a-scene');
        const startBtn = document.querySelector('#startBtn');
        const overlay = document.querySelector('#overlay');

        // 1. Initialize AR on Button Click (iOS/Android requirement)
        startBtn.addEventListener('click', () => {
            overlay.style.display = 'none';
            sceneEl.systems['mindar-world-system'].start();
        });

        // 2. Swipe Logic
        let touchStartY = 0;
        let touchStartTime = 0;

        window.addEventListener('touchstart', (e) => {
            touchStartY = e.touches[0].clientY;
            touchStartTime = Date.now();
        });

        window.addEventListener('touchend', (e) => {
            const touchEndY = e.changedTouches[0].clientY;
            const duration = Date.now() - touchStartTime;
            const distance = touchStartY - touchEndY; // Positive is UP

            if (distance > 50 && duration < 300) {
                // Calculate power based on swipe speed
                const power = Math.min(distance / duration * 10, 20); 
                throwPaper(power);
            }
        });

        function throwPaper(power) {
            const ball = document.createElement('a-sphere');
            ball.setAttribute('radius', '0.08');
            ball.setAttribute('color', '#eee');
            ball.setAttribute('roughness', '1');
            
            // Position ball at bottom of screen
            ball.setAttribute('position', '0 0.5 -0.5');
            ball.setAttribute('dynamic-body', 'mass: 0.5');
            
            sceneEl.appendChild(ball);

            ball.addEventListener('body-loaded', () => {
                // Push ball: Forward (-z) and Up (+y)
                const impulse = new CANNON.Vec3(0, power * 0.5, -power);
                const pos = new CANNON.Vec3(0, 0, 0);
                ball.body.applyImpulse(impulse, pos);

                // Auto-cleanup to keep performance high
                setTimeout(() => {
                    if(ball.parentNode) ball.parentNode.removeChild(ball);
                }, 4000);
            });
        }
    </script>
</body>
</html>