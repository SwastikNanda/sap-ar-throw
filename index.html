<!-- <!DOCTYPE html>
<html>
<head>
  <title>SAP AR Toss</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ar.js@3.4.4/aframe/build/aframe-ar.js"></script>
  <script src="game.js"></script>

  <style>
    body { margin: 0; overflow: hidden; }
    #score {
      position: fixed;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 10px;
      z-index: 999;
    }
  </style>
</head>

<body>

<div id="score">Score: 0</div>

<a-scene
  vr-mode-ui="enabled: false"
  arjs="sourceType: webcam; debugUIEnabled: false;"
>

  <a-marker preset="hiro">

    <a-cylinder id="basket"
                position="0 0.25 0"
                radius="0.3"
                height="0.5"
                color="#333">
    </a-cylinder>

    <a-sphere id="sapBall"
              radius="0.08"
              position="0 0.6 0.5"
              color="#0a6ed1"
              ball-motion>
    </a-sphere>

  </a-marker>

  <a-entity camera></a-entity>

</a-scene>

</body>
</html> -->

<!-- <!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>WebAR Paper Toss - Final</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>
</head>

<body style="margin: 0; overflow: hidden;">
    <div id="overlay" style="position:fixed; top:0; left:0; width:100%; height:100%; z-index:999; background:rgba(0,0,0,0.8); display:flex; flex-direction:column; justify-content:center; align-items:center; color:white; font-family:sans-serif;">
        <h1>AR Paper Toss</h1>
        <button onclick="start()" style="padding:15px 30px; font-size:20px; border-radius:10px; border:none; background:#2ecc71; color:white;">PLAY</button>
    </div>

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" physics="gravity: -9.8; debug: false">
        
        <a-entity id="rig" position="0 0 0">
            <a-camera id="cam" look-controls="enabled: true"></a-camera>
        </a-entity>

        <a-entity id="basket" position="0 0 -4">
            <a-cylinder color="#666" height="0.7" radius="0.4" open-ended="true" side="double" static-body></a-cylinder>
            <a-circle position="0 -0.3 0" rotation="-90 0 0" radius="0.4" color="#222" static-body></a-circle>
        </a-entity>

        <a-plane position="0 -0.5 0" rotation="-90 0 0" width="100" height="100" static-body transparent="true" opacity="0.2" color="#444"></a-plane>

        <a-light type="ambient" intensity="0.8"></a-light>
    </a-scene>

    <script>
        const scene = document.querySelector('a-scene');
        const cam = document.getElementById('cam');

        function start() {
            document.getElementById('overlay').style.display = 'none';
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission();
            }
        }

        let startY, startTime;
        window.addEventListener('touchstart', e => {
            startY = e.touches[0].clientY;
            startTime = Date.now();
        });

        window.addEventListener('touchend', e => {
            let duration = Date.now() - startTime;
            let dist = startY - e.changedTouches[0].clientY;
            if (dist > 50) {
                // Calculate strength based on swipe speed
                let strength = Math.min(dist / duration * 15, 25);
                throwBall(strength);
            }
        });

        function throwBall(speed) {
            const ball = document.createElement('a-sphere');
            ball.setAttribute('radius', '0.12');
            ball.setAttribute('color', 'white');
            
            // 1. Get Camera's World Position and Direction
            const pos = cam.object3D.position;
            const direction = new THREE.Vector3(0, 0, -1);
            direction.applyQuaternion(cam.object3D.quaternion);

            // 2. Set ball starting position slightly in front of camera
            ball.setAttribute('position', {
                x: pos.x + direction.x * 0.5,
                y: pos.y + direction.y * 0.5,
                z: pos.z + direction.z * 0.5
            });

            ball.setAttribute('dynamic-body', 'mass: 0.5');
            scene.appendChild(ball);

            ball.addEventListener('body-loaded', () => {
                // 3. Apply force in the direction the camera is facing
                // We add a little "up" force (0.3) so it arcs like a real toss
                const forceVector = new CANNON.Vec3(
                    direction.x * speed,
                    (direction.y + 0.5) * speed, 
                    direction.z * speed
                );
                
                ball.body.applyImpulse(forceVector, new CANNON.Vec3(0,0,0));
                
                // Cleanup
                setTimeout(() => { if(ball.parentNode) ball.parentNode.removeChild(ball); }, 4000);
            });
        }
    </script>
</body>
</html> -->
<!-- 
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Fixed AR Paper Toss</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>
</head>

<body style="margin: 0; overflow: hidden;">
    <div id="overlay" style="position:fixed; top:0; left:0; width:100%; height:100%; z-index:999; background:rgba(0,0,0,0.9); display:flex; flex-direction:column; justify-content:center; align-items:center; color:white; font-family:sans-serif;">
        <button onclick="start()" style="padding:20px 40px; font-size:24px; border-radius:10px; border:none; background:#e74c3c; color:white; cursor:pointer;">START GAME</button>
    </div>

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" physics="gravity: -9.8; debug: false">
        
        <a-entity camera look-controls id="myCam" position="0 1.6 0"></a-entity>

        <a-entity id="basket" position="0 0 -4">
            <a-cylinder color="#ff3333" height="0.8" radius="0.4" open-ended="true" side="double" static-body></a-cylinder>
            <a-circle position="0 -0.35 0" rotation="-90 0 0" radius="0.4" color="#111" static-body></a-circle>
        </a-entity>

        <a-plane position="0 -0.1 0" rotation="-90 0 0" width="100" height="100" static-body transparent="true" opacity="0.3" color="#222"></a-plane>

        <a-light type="ambient" intensity="0.8"></a-light>
    </a-scene>

    <script>
        const scene = document.querySelector('a-scene');
        const camEntity = document.querySelector('#myCam');
        let canThrow = true; // Debounce flag

        function start() {
            document.getElementById('overlay').style.display = 'none';
        }

        let startY, startTime;

        window.addEventListener('touchstart', (e) => {
            startY = e.touches[0].clientY;
            startTime = Date.now();
        });

        window.addEventListener('touchend', (e) => {
            if (!canThrow) return; // Stop if we just threw a ball

            let endY = e.changedTouches[0].clientY;
            let duration = Date.now() - startTime;
            let distance = startY - endY;

            if (distance > 60) {
                canThrow = false; // Lock throwing
                let speed = Math.min(distance / duration * 10, 20);
                throwBall(speed);

                // Re-enable throwing after 1.2 seconds
                setTimeout(() => { canThrow = true; }, 1200);
            }
        });

        function throwBall(speed) {
            const ball = document.createElement('a-sphere');
            ball.setAttribute('radius', '0.12');
            ball.setAttribute('color', 'white');
            
            // Get Camera position and rotation
            const pos = camEntity.object3D.position;
            const camRotation = camEntity.object3D.quaternion;
            
            // Direction the camera is facing
            const direction = new THREE.Vector3(0, 0, -1);
            direction.applyQuaternion(camRotation);

            // Spawn ball in front of camera
            ball.setAttribute('position', {
                x: pos.x + direction.x,
                y: pos.y + direction.y,
                z: pos.z + direction.z
            });

            ball.setAttribute('dynamic-body', 'mass: 0.5');
            scene.appendChild(ball);

            ball.addEventListener('body-loaded', () => {
                // Apply force in the direction we are looking
                const force = new CANNON.Vec3(
                    direction.x * speed,
                    (direction.y + 0.4) * speed, // Add some lift
                    direction.z * speed
                );
                ball.body.applyImpulse(force, new CANNON.Vec3(0,0,0));
                
                // Self-destruct ball after 4 seconds
                setTimeout(() => { if(ball.parentNode) ball.parentNode.removeChild(ball); }, 4000);
            });
        }
    </script>
</body>
</html> -->

<!-- <!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Instant AR Paper Toss</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
</head>

<body style="margin: 0; overflow: hidden; background-color: black;">

    <div id="overlay" style="position:fixed; top:0; left:0; width:100%; height:100%; z-index:1000; background:rgba(0,0,0,0.8); display:flex; flex-direction:column; justify-content:center; align-items:center; color:white; font-family:sans-serif;">
        <h1 style="margin-bottom:10px;">AR Paper Toss</h1>
        <p style="margin-bottom:20px; text-align:center; padding: 0 20px;">Point camera forward & flick up to play!</p>
        <button onclick="startGame()" style="padding:15px 40px; font-size:20px; border-radius:50px; border:none; background:#3498db; color:white; font-weight:bold; cursor:pointer;">START CAMERA</button>
    </div>

    <div id="msg" style="position:fixed; top:20px; width:100%; text-align:center; color:white; font-family:sans-serif; z-index:500; display:none; text-shadow: 2px 2px black;">Nice Shot!</div>

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false; trackingMethod: best;" vr-mode-ui="enabled: false">
        
        <a-entity id="basket" position="0 -1 -4">
            <a-cylinder color="#e74c3c" height="0.8" radius="0.4" open-ended="true" side="double"></a-cylinder>
            <a-circle position="0 -0.39 0" rotation="-90 0 0" radius="0.4" color="#2c3e50"></a-circle>
            <a-text value="TARGET" align="center" position="0 0.8 0" scale="1.5 1.5 1.5"></a-text>
        </a-entity>

        <a-entity camera id="playerCam" look-controls position="0 1.6 0">
            <a-ring color="white" radius-inner="0.02" radius-outer="0.03" position="0 0 -1" shader="flat"></a-ring>
        </a-entity>

    </a-scene>

    <script>
        let canThrow = true;
        const scene = document.querySelector('a-scene');
        const cam = document.querySelector('#playerCam');
        const msg = document.querySelector('#msg');

        function startGame() {
            document.getElementById('overlay').style.display = 'none';
        }

        // SWIPE DETECTION
        let startY, startTime;

        window.addEventListener('touchstart', (e) => {
            startY = e.touches[0].clientY;
            startTime = Date.now();
        });

        window.addEventListener('touchend', (e) => {
            if (!canThrow) return;

            let endY = e.changedTouches[0].clientY;
            let duration = Date.now() - startTime;
            let distance = startY - endY;

            // Only trigger if it's a fast flick upward
            if (distance > 60 && duration < 400) {
                canThrow = false;
                throwBall();
                // Re-enable after 1.5 seconds
                setTimeout(() => { canThrow = true; }, 1500);
            }
        });

        function throwBall() {
            const ball = document.createElement('a-sphere');
            ball.setAttribute('radius', '0.15');
            ball.setAttribute('color', 'white');
            ball.setAttribute('metalness', '0.2');
            
            // 1. Get exact position and view direction of camera
            const camPos = cam.object3D.position;
            const camRot = cam.object3D.quaternion;
            const direction = new THREE.Vector3(0, 0, -1);
            direction.applyQuaternion(camRot);

            // 2. Spawn ball exactly in front of your face
            const spawnPos = {
                x: camPos.x + direction.x,
                y: camPos.y + direction.y,
                z: camPos.z + direction.z
            };

            // 3. Target position (where the ball will land)
            const targetPos = {
                x: spawnPos.x + direction.x * 5,
                y: -1.5, // It falls to the floor level
                z: spawnPos.z + direction.z * 5
            };

            ball.setAttribute('position', spawnPos);
            scene.appendChild(ball);

            // 4. ANIMATE THE THROW (Bypass Physics engine bugs)
            // This creates a simple parabola-like movement
            ball.setAttribute('animation__pos', {
                property: 'position',
                to: `${targetPos.x} ${targetPos.y} ${targetPos.z}`,
                dur: 1000,
                easing: 'easeOutQuad'
            });

            // Shrink effect to simulate distance
            ball.setAttribute('animation__scale', {
                property: 'scale',
                to: '0.5 0.5 0.5',
                dur: 1000
            });

            // 5. Cleanup
            setTimeout(() => {
                if (ball.parentNode) ball.parentNode.removeChild(ball);
                // Show "Goal" message for fun
                msg.style.display = 'block';
                setTimeout(() => { msg.style.display = 'none'; }, 800);
            }, 1000);
        }
    </script>
</body>
</html> -->


<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Stationary Bin AR</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

    <style>
        /* CRITICAL: Prevents the browser from moving the scene during swipes */
        canvas.a-canvas {
            touch-action: none !important;
        }
    </style>

</head>

<body style="margin: 0; overflow: hidden;">
    <div id="overlay" style="position:fixed; top:0; left:0; width:100%; height:100%; z-index:1000; background:rgba(0,0,0,0.8); display:flex; flex-direction:column; justify-content:center; align-items:center; color:white; font-family:sans-serif;">
        <button onclick="start()" style="padding:20px 40px; font-size:24px; border-radius:10px; border:none; background:#e67e22; color:white;">SET BIN & PLAY</button>
        <p style="margin-top:10px">Look straight ahead before clicking</p>
    </div>

    <!-- <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false; trackingMethod: best;">
        
        <a-entity id="basket" position="0 -2 -7">
            <a-cylinder color="#e74c3c" height="1" radius="0.5" open-ended="true" side="double"></a-cylinder>
            <a-circle position="0 -0.45 0" rotation="-90 0 0" radius="0.5" color="#2c3e50"></a-circle>
            <a-text value="STATIONARY BIN" align="center" position="0 1.2 0" scale="2 2 2"></a-text>
        </a-entity>

        <a-entity camera look-controls id="mainCam"></a-entity>

    </a-scene> -->
<!-- 
    <a-scene 
    embedded 
    arjs="sourceType: webcam; debugUIEnabled: false; trackingMethod: best; detectionMode: mono_and_matrix;"
    vr-mode-ui="enabled: false"
    renderer="logarithmicDepthBuffer: true;">

    <a-entity id="world-root">
        <a-entity id="basket" position="0 -1.5 -7">
            <a-cylinder color="#e74c3c" height="1" radius="0.5" open-ended="true" side="double"></a-cylinder>
            <a-circle position="0 -0.45 0" rotation="-90 0 0" radius="0.5" color="#2c3e50"></a-circle>
            
            <a-text value="STATIONARY BIN" align="center" position="0 1.5 0" scale="2 2 2" color="white"></a-text>
            
            <a-ring color="black" radius-inner="0.4" radius-outer="0.7" rotation="-90 0 0" position="0 -0.49 0" opacity="0.4"></a-ring>
        </a-entity>
    </a-entity>

    <a-entity id="camera-rig" position="0 1.6 0">
        <a-camera id="mainCam" look-controls="enabled: true" wasd-controls-enabled="false">
            <a-entity cursor="fuse: false" position="0 0 -1"
                      geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.015"
                      material="color: #FFF; shader: flat">
            </a-entity>
        </a-camera>
    </a-entity>

</a-scene> -->

<a-scene 
        embedded 
        arjs="sourceType: webcam; debugUIEnabled: false; trackingMethod: best;"
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true;">

        <!-- <a-entity id="world-root">
            <a-entity id="basket" position="0 -1.5 -7">
                <a-cylinder color="#e74c3c" height="1" radius="0.5" open-ended="true" side="double"></a-cylinder>
                <a-circle position="0 -0.45 0" rotation="-90 0 0" radius="0.5" color="#2c3e50"></a-circle>
                <a-text value="STATIONARY BIN" align="center" position="0 1.5 0" scale="2 2 2" color="white"></a-text>
                <a-ring color="black" radius-inner="0.4" radius-outer="0.7" rotation="-90 0 0" position="0 -0.49 0" opacity="0.4"></a-ring>
            </a-entity>
        </a-entity> -->

        <a-entity id="world-root">
    <a-entity id="basket-center" position="0 -1.5 -7">
        <a-cylinder color="#e74c3c" height="1" radius="0.65" open-ended="true" side="double"></a-cylinder>
        <a-text value="Veggies" align="center" position="0 1.5 0" scale="2 2 2"></a-text>
    </a-entity>

    <a-entity id="basket-left" position="-2.5 -1.5 -7">
        <a-cylinder color="#3498db" height="1" radius="0.65" open-ended="true" side="double"></a-cylinder>
        <a-text value="Fruits" align="center" position="0 1.5 0" scale="2 2 2"></a-text>
    </a-entity>

    <a-entity id="basket-right" position="2.5 -1.5 -7">
        <a-cylinder color="#f1c40f" height="1" radius="0.65" open-ended="true" side="double"></a-cylinder>
        <a-text value="KuchAur" align="center" position="0 1.5 0" scale="2 2 2"></a-text>
    </a-entity>
</a-entity>

        <a-entity id="camera-rig" position="0 1.6 0">
            <a-camera id="mainCam" 
                      look-controls="enabled: true; touchEnabled: false; magicWindowTrackingEnabled: true" 
                      wasd-controls-enabled="false">
                <a-entity cursor="fuse: false" position="0 0 -1"
                          geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.015"
                          material="color: #FFF; shader: flat">
                </a-entity>
            </a-camera>
        </a-entity>

    </a-scene>

<div id="score-container" style="position:fixed; top:20px; left:20px; z-index:1001; pointer-events:none; font-family:sans-serif; text-shadow:2px 2px 4px #000;">
    <div style="color:#2ecc71; font-size:12px; font-weight:bold; letter-spacing: 1px;">SCORE</div>
    <div id="score-val" style="color:white; font-size:32px; font-weight:bold;">0</div>
</div>

<div id="target-container" style="position:fixed; top:20px; left:50%; transform:translateX(-50%); z-index:1001; text-align:center; font-family:sans-serif; pointer-events:none;">
    <div style="color:#67e8f9; font-size:12px; font-weight:bold; letter-spacing: 2px; text-shadow:1px 1px 2px #000;">HOLDING</div>
    <div id="current-label-ui" style="color:white; font-size:28px; font-weight:bold; text-shadow:2px 2px 5px #000; background:rgba(0,0,0,0.3); padding:5px 20px; border-radius:15px; border:1px solid rgba(255,255,255,0.2);">---</div>
</div>

<div id="timer-container" style="position:fixed; top:20px; right:20px; z-index:1001; pointer-events:none; font-family:sans-serif; text-shadow:2px 2px 4px #000; text-align:right;">
    <div style="color:#e67e22; font-size:12px; font-weight:bold; letter-spacing: 1px;">TIME</div>
    <div id="time-val" style="color:white; font-size:32px; font-weight:bold;">60</div>
</div>

<script>
  let score = 0;
let timeLeft = 60;
let canThrow = false;
let gameActive = false;
let timerInterval;
let currentItem = null; // Stores the item currently "in hand"

const scene = document.querySelector('a-scene');
const cam = document.querySelector('#mainCam');

const gameConfig = [
    { label: "Apple", target: "basket-left" },
    { label: "Banana", target: "basket-left" },
    { label: "Carrot", target: "basket-center" },
    { label: "Broccoli", target: "basket-center" },
    { label: "Lollipop", target: "basket-right" },
    { label: "Chocolate", target: "basket-right" }
];

// NEW: Function to pick the next item and update the Top UI
function prepareNextItem() {
    currentItem = gameConfig[Math.floor(Math.random() * gameConfig.length)];
    const uiLabel = document.getElementById('current-label-ui');
    if (uiLabel) {
        uiLabel.innerText = currentItem.label.toUpperCase();
    }
}

function start() {
    document.getElementById('overlay').style.display = 'none';
    score = 0;
    timeLeft = 60;
    gameActive = true;
    canThrow = true;
    
    document.getElementById('score-val').innerText = "0";
    document.getElementById('time-val').innerText = "60";
    document.getElementById('time-val').style.color = "white";
    
    prepareNextItem(); // Load the first item
    startTimer();
}

function startTimer() {
    timerInterval = setInterval(() => {
        timeLeft--;
        const timerEl = document.getElementById('time-val');
        timerEl.innerText = timeLeft;

        if (timeLeft <= 10) {
            timerEl.style.color = "#ff3333";
        }

        if (timeLeft <= 0) {
            endGame();
        }
    }, 1000);
}

function endGame() {
    clearInterval(timerInterval);
    gameActive = false;
    canThrow = false;
    alert("Time's Up! \nFinal Score: " + score);
    location.reload();
}

// --- SWIPE LOGIC ---
let startX, startY, startTime;
window.addEventListener('touchstart', (e) => {
    startX = e.touches[0].clientX;
    startY = e.touches[0].clientY;
    startTime = Date.now();
});

window.addEventListener('touchend', (e) => {
    if (!canThrow || !gameActive) return;

    let diffX = e.changedTouches[0].clientX - startX;
    let diffY = startY - e.changedTouches[0].clientY;

    if (diffY > 60) {
        canThrow = false;
        let horizontalTilt = diffX / window.innerWidth; 
        throwBall(horizontalTilt);
        setTimeout(() => { if(gameActive) canThrow = true; }, 800);
    }
});

function throwBall(tilt) {
    // 1. Capture the item being thrown NOW
    const itemBeingThrown = currentItem;
    
    const wrapper = document.createElement('a-entity');
    const ball = document.createElement('a-sphere');
    // NOTE: No 3D label created here, as it's now in the Top UI
    
    ball.setAttribute('radius', '0.15');
    ball.setAttribute('color', 'white');
    wrapper.appendChild(ball);
    scene.appendChild(wrapper);

    // 2. Immediately update UI for the NEXT throw
    prepareNextItem();

    const startPos = new THREE.Vector3();
    cam.object3D.getWorldPosition(startPos);
    const direction = new THREE.Vector3(0, 0, -1);
    direction.applyQuaternion(cam.object3D.quaternion);
    const sideVector = new THREE.Vector3(1, 0, 0); 
    sideVector.applyQuaternion(cam.object3D.quaternion);
    direction.addScaledVector(sideVector, tilt * 2); 

    wrapper.setAttribute('position', {
        x: startPos.x + direction.x * 0.5,
        y: startPos.y + direction.y * 0.5,
        z: startPos.z + direction.z * 0.5
    });

    const distance = 8;
    const endPos = {
        x: startPos.x + direction.x * distance,
        y: -1.5, 
        z: startPos.z + direction.z * distance
    };

    wrapper.setAttribute('animation', { property: 'position', to: `${endPos.x} ${endPos.y} ${endPos.z}`, dur: 1000, easing: 'linear' });
    ball.setAttribute('animation__up', { property: 'position', from: '0 0 0', to: '0 1.5 0', dur: 400, easing: 'easeOutQuad' });

    setTimeout(() => {
        ball.setAttribute('animation__down', { property: 'position', to: '0 0 0', dur: 600, easing: 'easeInQuad' });
    }, 400);

    setTimeout(() => {
        const buckets = ['basket-left', 'basket-center', 'basket-right'];
        buckets.forEach(id => {
            const bucket = document.getElementById(id);
            const bPos = bucket.object3D.position;
            const dist = Math.sqrt(Math.pow(endPos.x - bPos.x, 2) + Math.pow(endPos.z - bPos.z, 2));

            if (dist < 0.9) {
                // Check against the item we captured at the START of the throw
                if (id === itemBeingThrown.target) {
                    score += 10;
                    updateScoreUI();
                    wiggleBucket(bucket, true);
                } else {
                    wiggleBucket(bucket, false);
                }
            }
        });
        if (wrapper.parentNode) wrapper.parentNode.removeChild(wrapper);
    }, 1100);
}

function updateScoreUI() {
    document.getElementById('score-val').innerText = score;
}

function wiggleBucket(entity, isCorrect) {
    entity.setAttribute('animation__wiggle', {
        property: 'rotation', to: '0 0 10', dur: 100, dir: 'alternate', loop: 4, easing: 'easeInOutQuad'
    });
    const cylinder = entity.querySelector('a-cylinder');
    const originalColor = cylinder.getAttribute('color');
    cylinder.setAttribute('color', isCorrect ? '#2ecc71' : '#ff3333');
    setTimeout(() => {
        cylinder.setAttribute('color', originalColor);
        entity.setAttribute('rotation', '0 0 0');
        entity.removeAttribute('animation__wiggle');
    }, 500);
}
</script>
</body>
</html>