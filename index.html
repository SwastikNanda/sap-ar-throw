<!-- <!DOCTYPE html>
<html>
<head>
  <title>SAP AR Toss</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ar.js@3.4.4/aframe/build/aframe-ar.js"></script>
  <script src="game.js"></script>

  <style>
    body { margin: 0; overflow: hidden; }
    #score {
      position: fixed;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 10px;
      z-index: 999;
    }
  </style>
</head>

<body>

<div id="score">Score: 0</div>

<a-scene
  vr-mode-ui="enabled: false"
  arjs="sourceType: webcam; debugUIEnabled: false;"
>

  <a-marker preset="hiro">

    <a-cylinder id="basket"
                position="0 0.25 0"
                radius="0.3"
                height="0.5"
                color="#333">
    </a-cylinder>

    <a-sphere id="sapBall"
              radius="0.08"
              position="0 0.6 0.5"
              color="#0a6ed1"
              ball-motion>
    </a-sphere>

  </a-marker>

  <a-entity camera></a-entity>

</a-scene>

</body>
</html> -->
<!DOCTYPE html>
<html>
<head>
    <title>WebAR Paper Toss - Final Fix</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>

    <style>
        #ui-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        button {
            padding: 20px 40px; font-size: 1.5rem; background: #FF5722;
            color: white; border: none; border-radius: 10px;
        }
    </style>
</head>

<body style="margin: 0; overflow: hidden;">

    <div id="ui-overlay">
        <button onclick="startAR()">ACTIVATE CAMERA</button>
        <p style="color:white; margin-top:20px;">Use Safari (iOS) or Chrome (Android)</p>
    </div>

    <a-scene 
        embedded 
        arjs="sourceType: webcam; debugUIEnabled: false;" 
        physics="gravity: -9.8; debug: false">
        
        <a-camera gps-camera rotation-reader></a-camera>

        <a-entity id="basket" position="0 0 -5">
            <a-cylinder color="red" height="1" radius="0.5" open-ended="true" side="double" static-body></a-cylinder>
            <a-circle position="0 -0.4 0" rotation="-90 0 0" radius="0.5" static-body color="black"></a-circle>
        </a-entity>

        <a-light type="ambient" intensity="1"></a-light>
    </a-scene>

    <script>
        function startAR() {
            // Hide UI
            document.getElementById('ui-overlay').style.display = 'none';
            
            // Requesting Motion/Orientation (Required for iOS Safari)
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(response => {
                        if (response == 'granted') {
                            console.log("Motion granted");
                        }
                    })
                    .catch(console.error);
            }
        }

        // Swipe Logic
        let startY, startTime;
        window.addEventListener('touchstart', e => {
            startY = e.touches[0].clientY;
            startTime = Date.now();
        });

        window.addEventListener('touchend', e => {
            let endY = e.changedTouches[0].clientY;
            let duration = Date.now() - startTime;
            let dist = startY - endY;

            if (dist > 50) {
                throwBall(dist / duration);
            }
        });

        function throwBall(speed) {
            const ball = document.createElement('a-sphere');
            ball.setAttribute('radius', '0.15');
            ball.setAttribute('position', '0 1 -1');
            ball.setAttribute('dynamic-body', 'mass: 1');
            ball.setAttribute('color', 'white');
            
            document.querySelector('a-scene').appendChild(ball);

            ball.addEventListener('body-loaded', () => {
                const force = speed * 15;
                const impulse = new CANNON.Vec3(0, force * 0.4, -force);
                ball.body.applyImpulse(impulse, new CANNON.Vec3(0, 0, 0));
            });
        }
    </script>
</body>
</html>